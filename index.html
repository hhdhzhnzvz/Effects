<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ферма растений: Вызов</title>
    <style>
        :root {
            --primary-color: #2E7D32;
            --primary-dark: #1B5E20;
            --primary-light: #81C784;
            --secondary-color: #EF6C00;
            --secondary-dark: #E65100;
            --background: #E8F5E9;
            --card-bg: #FFFFFF;
            --text-color: #263238;
            --disabled: #B0BEC5;
            --premium: #FFAB00;
            --error: #C62828;
            --success: #2E7D32;
        }
        
        body {
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text-color);
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            line-height: 1.6;
        }
        
        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        #header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15));
        }
        
        #money-display {
            font-size: 32px;
            font-weight: bold;
            background: rgba(0,0,0,0.25);
            padding: 12px 24px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        #money-display::before {
            content: '$';
            margin-right: 5px;
            font-size: 0.9em;
        }
        
        #farm-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 18px;
            margin-bottom: 25px;
        }
        
        .plot {
            aspect-ratio: 1/1;
            background: linear-gradient(to bottom, #8D6E63, #6D4C41);
            border: 3px solid #5D4037;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .plot:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 20px rgba(0,0,0,0.2);
        }
        
        .plot.empty {
            background: linear-gradient(to bottom, #A1887F, #8D6E63);
            border: 3px dashed #5D4037;
        }
        
        .plant {
            width: 90%;
            height: 90%;
            position: relative;
            transition: all 0.4s ease-out;
        }
        
        .plant-image {
            width: 100%;
            height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3));
        }
        
        .progress-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 12px;
            background-color: rgba(0,0,0,0.15);
            z-index: 1;
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            width: 0%;
            transition: width 0.7s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .plant-value {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--secondary-color);
            color: white;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        #controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            flex: 1;
            min-width: 140px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .tab:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.25);
            transform: none;
        }
        
        .panel {
            display: none;
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 18px;
            margin-bottom: 25px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
            animation: fadeIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-title {
            margin: 0 0 25px 0;
            color: var(--primary-dark);
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: 12px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .panel-title .emoji {
            font-size: 32px;
        }
        
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .seed-item, .upgrade-item {
            background-color: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(0,0,0,0.08);
            position: relative;
        }
        
        .seed-item:hover, .upgrade-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.18);
        }
        
        .premium-item {
            border: 2px solid var(--premium);
            box-shadow: 0 6px 15px rgba(255, 171, 0, 0.25);
        }
        
        .premium-item .item-header {
            background: linear-gradient(135deg, #FFC400, #FFAB00);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            color: white;
            position: relative;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .item-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15));
        }
        
        .item-name {
            font-weight: bold;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .item-price {
            font-weight: bold;
            background: rgba(0,0,0,0.25);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 18px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .item-body {
            padding: 20px;
        }
        
        .item-desc {
            color: #455A64;
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .item-stats {
            display: flex;
            justify-content: space-between;
            font-size: 15px;
            color: #546E7A;
            margin-bottom: 20px;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #E0E0E0;
        }
        
        .buy-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 17px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .buy-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--secondary-dark), var(--secondary-color));
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .buy-btn:disabled {
            background: var(--disabled);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .premium-btn {
            background: linear-gradient(135deg, #FFC400, #FFAB00);
        }
        
        .premium-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #FFAB00, #FFC400);
        }
        
        #stats-panel {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 18px;
            margin-bottom: 25px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 25px;
        }
        
        .stat-card {
            background-color: #f5f5f5;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid #E0E0E0;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .stat-name {
            font-weight: bold;
            color: #455A64;
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        #expand-farm-btn {
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 25px;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        #expand-farm-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }
        
        #expand-farm-btn:disabled {
            background: var(--disabled);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        #auto-manager-panel {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 18px;
            margin-bottom: 25px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
        }
        
        .auto-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 25px;
            background-color: #f5f5f5;
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid #E0E0E0;
        }
        
        .toggle-label {
            font-weight: bold;
            font-size: 19px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #455A64;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 75px;
            height: 40px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #B0BEC5;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 32px;
            width: 32px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(35px);
        }
        
        .select-wrapper {
            margin-top: 30px;
            background-color: #f5f5f5;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid #E0E0E0;
        }
        
        .select-label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 19px;
            color: #455A64;
        }
        
        #auto-seed-type {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #B0BEC5;
            background-color: white;
            font-size: 17px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        #auto-seed-type:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
            outline: none;
        }
        
        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .bounce {
            animation: bounce 1.5s infinite;
        }
        
        @keyframes shine {
            0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.7); }
            100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0); }
        }
        
        .shine {
            animation: shine 2s infinite;
        }
        
        /* Модальное окно */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.4s;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            animation: slideUp 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            color: white;
            font-size: 24px;
            font-weight: bold;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 25px;
            display: flex;
            justify-content: flex-end;
            border-top: 1px solid #E0E0E0;
        }
        
        .modal-btn {
            padding: 15px 30px;
            margin-left: 20px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 17px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .modal-btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .modal-btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .modal-btn-secondary:hover {
            background: #e0e0e0;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        /* Дополнительные стили */
        .premium-badge {
            position: absolute;
            top: -12px;
            right: -12px;
            background: var(--premium);
            color: #5D4037;
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            transform: rotate(15deg);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 3;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: slideIn 0.4s, fadeOut 0.5s 3s forwards;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            border-left: 5px solid var(--primary-dark);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .achievement-badge {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: var(--secondary-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        .locked-item {
            position: relative;
            overflow: hidden;
        }
        
        .locked-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .locked-item .item-header {
            background: linear-gradient(135deg, #B0BEC5, #78909C);
        }
        
        /* Адаптация для мобильных */
        @media (max-width: 768px) {
            #game-container {
                padding: 15px;
            }
            
            #farm-container {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 12px;
            }
            
            .item-list {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tab {
                min-width: 100%;
                padding: 14px;
                font-size: 16px;
            }
            
            #header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px;
            }
            
            #money-display {
                width: 100%;
                justify-content: center;
                font-size: 28px;
                padding: 10px 20px;
            }
            
            .panel {
                padding: 20px;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .notification {
                top: 20px;
                right: 20px;
                left: 20px;
                max-width: none;
            }
        }
        
        /* Прогресс-бар уровня */
        .level-container {
            width: 100%;
            background: #E0E0E0;
            border-radius: 10px;
            margin: 20px 0;
            height: 20px;
            overflow: hidden;
        }
        
        .level-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            width: 0%;
            transition: width 0.5s;
            position: relative;
        }
        
        .level-text {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        /* Тень для текста */
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">
            <h1 class="text-shadow">🌱 Ферма растений: Вызов</h1>
            <div id="money-display">0</div>
        </div>
        
        <button id="expand-farm-btn">🔄 Расширить ферму ($100)</button>
        
        <div id="farm-container"></div>
        
        <div id="controls">
            <button class="tab active" data-panel="seeds-panel">🌰 Семена</button>
            <button class="tab" data-panel="upgrades-panel">⚡ Улучшения</button>
            <button class="tab" data-panel="auto-manager-panel">🤖 Автоматизация</button>
            <button class="tab" data-panel="stats-panel">📊 Статистика</button>
        </div>
        
        <div id="seeds-panel" class="panel active">
            <h2 class="panel-title"><span class="emoji">🌰</span> Магазин семян</h2>
            <div id="seeds-list" class="item-list"></div>
        </div>
        
        <div id="upgrades-panel" class="panel">
            <h2 class="panel-title"><span class="emoji">⚡</span> Улучшения</h2>
            <div class="level-container">
                <div class="level-progress" id="level-progress">
                    <span class="level-text">Уровень: 1</span>
                </div>
            </div>
            <div id="upgrades-list" class="item-list"></div>
        </div>
        
        <div id="auto-manager-panel" class="panel">
            <h2 class="panel-title"><span class="emoji">🤖</span> Автоматизация</h2>
            <div class="auto-toggle">
                <span class="toggle-label">🌱 Автопосадка</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-plant-toggle" disabled>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="auto-toggle">
                <span class="toggle-label">✂️ Автосбор</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-harvest-toggle" disabled>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="select-wrapper">
                <label class="select-label" for="auto-seed-type">🌱 Семена для автопосадки:</label>
                <select id="auto-seed-type" class="buy-btn" disabled>
                    <!-- Заполнится динамически -->
                </select>
            </div>
        </div>
        
        <div id="stats-panel" class="panel">
            <h2 class="panel-title"><span class="emoji">📊</span> Статистика</h2>
            <div id="stats-list" class="stats-grid"></div>
        </div>
    </div>

    <script>
        // Основные переменные игры
        let money = 60;
        let farmSize = 5;
        let plots = [];
        let seeds = [];
        let upgrades = [];
        let stats = {
            totalMoneyEarned: 0,
            plantsHarvested: 0,
            seedsPlanted: 0,
            moneySpent: 0,
            timePlayed: 0,
            farmExpansions: 0,
            plantsHarvestedByType: {},
            achievements: [],
            playerLevel: 1,
            playerXP: 0
        };
        
        // Автоматизация
        let autoPlantEnabled = false;
        let autoHarvestEnabled = false;
        let autoSeedType = null;
        
        // Инициализация игры
        function initGame() {
            initSeeds();
            initUpgrades();
            initFarm();
            updateUI();
            loadGame();
            
            // Сохраняем игру каждые 10 секунд
            setInterval(saveGame, 10000);
            
            // Обновляем статистику времени каждую секунду
            setInterval(() => {
                stats.timePlayed++;
                updateStatsUI();
                checkAchievements();
            }, 1000);
            
            // Автоматическая проверка растений каждую секунду
            setInterval(checkPlants, 1000);
        }
        
        // Инициализация семян
        function initSeeds() {
            seeds = [
                {
                    id: 'carrot',
                    name: 'Морковь',
                    price: 15,
                    growthTime: 15,
                    value: 25,
                    stages: 3,
                    description: 'Быстрорастущий овощ, хороший выбор для начинающих.',
                    emoji: '🥕',
                    unlocked: true,
                    xp: 1
                },
                {
                    id: 'wheat',
                    name: 'Пшеница',
                    price: 30,
                    growthTime: 20,
                    value: 45,
                    stages: 4,
                    description: 'Основная зерновая культура, требует немного больше времени.',
                    emoji: '🌾',
                    unlocked: true,
                    xp: 2
                },
                {
                    id: 'tomato',
                    name: 'Помидор',
                    price: 75,
                    growthTime: 30,
                    value: 100,
                    stages: 5,
                    description: 'Популярный овощ с высокой прибыльностью.',
                    emoji: '🍅',
                    unlocked: true,
                    xp: 3
                },
                {
                    id: 'strawberry',
                    name: 'Клубника',
                    price: 150,
                    growthTime: 40,
                    value: 200,
                    stages: 5,
                    description: 'Сладкая ягода, любимая многими.',
                    emoji: '🍓',
                    unlocked: true,
                    xp: 4
                },
                {
                    id: 'pumpkin',
                    name: 'Тыква',
                    price: 300,
                    growthTime: 60,
                    value: 450,
                    stages: 6,
                    description: 'Крупный овощ с долгим сроком созревания.',
                    emoji: '🎃',
                    unlocked: true,
                    xp: 5
                },
                {
                    id: 'blueberry',
                    name: 'Черника',
                    price: 525,
                    growthTime: 70,
                    value: 750,
                    stages: 6,
                    description: 'Полезная ягода с высокой стоимостью.',
                    emoji: '🫐',
                    unlocked: true,
                    xp: 6
                },
                {
                    id: 'melon',
                    name: 'Дыня',
                    price: 750,
                    growthTime: 80,
                    value: 1125,
                    stages: 7,
                    description: 'Сочный фрукт, который требует терпения.',
                    emoji: '🍈',
                    unlocked: true,
                    xp: 7
                },
                {
                    id: 'dragonfruit',
                    name: 'Драконий фрукт',
                    price: 1500,
                    growthTime: 110,
                    value: 2500,
                    stages: 8,
                    description: 'Экзотический фрукт с высокой стоимостью.',
                    emoji: '🐉',
                    unlocked: true,
                    xp: 8
                },
                {
                    id: 'golden_berry',
                    name: 'Золотая ягода',
                    price: 7500,
                    growthTime: 150,
                    value: 12500,
                    stages: 8,
                    description: 'Редкая и ценная культура для опытных фермеров.',
                    emoji: '🌟',
                    unlocked: true,
                    xp: 10
                },
                {
                    id: 'avocado',
                    name: 'Авокадо',
                    price: 12000,
                    growthTime: 180,
                    value: 20000,
                    stages: 8,
                    description: 'Модный и питательный фрукт с высокой стоимостью.',
                    emoji: '🥑',
                    unlocked: false,
                    xp: 12
                },
                {
                    id: 'pineapple',
                    name: 'Ананас',
                    price: 18000,
                    growthTime: 220,
                    value: 32500,
                    stages: 9,
                    description: 'Тропический фрукт с долгим сроком созревания.',
                    emoji: '🍍',
                    unlocked: false,
                    xp: 15
                },
                {
                    id: 'mushroom',
                    name: 'Грибы',
                    price: 30000,
                    growthTime: 280,
                    value: 60000,
                    stages: 9,
                    description: 'Дорогие грибы, требующие особых условий.',
                    emoji: '🍄',
                    unlocked: false,
                    xp: 18
                },
                {
                    id: 'coffee',
                    name: 'Кофе',
                    price: 75000,
                    growthTime: 350,
                    value: 150000,
                    stages: 10,
                    description: 'Элитные кофейные зерна для настоящих гурманов.',
                    emoji: '☕',
                    unlocked: false,
                    xp: 22
                },
                {
                    id: 'truffle',
                    name: 'Трюфель',
                    price: 150000,
                    growthTime: 420,
                    value: 375000,
                    stages: 10,
                    description: 'Самый дорогой гриб в мире!',
                    emoji: '🍫',
                    unlocked: false,
                    xp: 30
                },
                {
                    id: 'golden_melon',
                    name: 'Золотая дыня',
                    price: 750000,
                    growthTime: 600,
                    value: 2500000,
                    stages: 12,
                    description: 'Легендарный фрукт, который приносит огромную прибыль.',
                    emoji: '🍈🌟',
                    unlocked: false,
                    xp: 50
                }
            ];
            
            // Инициализация статистики по каждому типу растения
            seeds.forEach(seed => {
                stats.plantsHarvestedByType[seed.id] = 0;
            });
            
            // Заполняем выпадающий список для автопосадки
            const select = document.getElementById('auto-seed-type');
            select.innerHTML = '<option value="">Выберите семена</option>';
            seeds.forEach(seed => {
                if (seed.unlocked) {
                    const option = document.createElement('option');
                    option.value = seed.id;
                    option.textContent = `${seed.emoji} ${seed.name}`;
                    select.appendChild(option);
                }
            });
            
            select.addEventListener('change', (e) => {
                autoSeedType = e.target.value;
                saveGame();
            });
        }
        
        // Разблокировка новых семян
        function unlockNewSeeds() {
            const moneyThresholds = [
                { amount: 10000, ids: ['avocado'] },
                { amount: 30000, ids: ['pineapple'] },
                { amount: 75000, ids: ['mushroom'] },
                { amount: 200000, ids: ['coffee'] },
                { amount: 750000, ids: ['truffle'] },
                { amount: 3000000, ids: ['golden_melon'] }
            ];
            
            moneyThresholds.forEach(threshold => {
                if (stats.totalMoneyEarned >= threshold.amount) {
                    threshold.ids.forEach(id => {
                        const seed = seeds.find(s => s.id === id);
                        if (seed && !seed.unlocked) {
                            seed.unlocked = true;
                            showNotification(`🔓 Разблокированы новые семена: ${seed.name} ${seed.emoji}`);
                            
                            // Обновляем выпадающий список автопосадки
                            const select = document.getElementById('auto-seed-type');
                            const option = document.createElement('option');
                            option.value = seed.id;
                            option.textContent = `${seed.emoji} ${seed.name}`;
                            select.appendChild(option);
                            
                            updateSeedsUI();
                        }
                    });
                }
            });
        }
        
        // Инициализация улучшений
        function initUpgrades() {
            upgrades = [
                {
                    id: 'faster_growth_1',
                    name: 'Ускоренный рост I',
                    price: 600, // Было 500
                    description: 'Растения растут на 10% быстрее.',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.growthTime = Math.max(1, Math.floor(seed.growthTime * 0.9));
                        });
                    },
                    xp: 5
                },
                {
                    id: 'higher_yield_1',
                    name: 'Повышенный урожай I',
                    price: 960, // Было 800
                    description: 'Растения приносят на 15% больше денег.',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.value = Math.floor(seed.value * 1.15);
                        });
                    },
                    xp: 5
                },
                {
                    id: 'discount_seeds_1',
                    name: 'Скидка на семена I',
                    price: 1200, // Было 1000
                    description: 'Семена стоят на 20% дешевле.',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.price = Math.max(1, Math.floor(seed.price * 0.8));
                        });
                        updateSeedsUI();
                    },
                    xp: 5
                },
                {
                    id: 'auto_planter',
                    name: 'Автопосадчик',
                    price: 7600, // Было 1500
                    description: 'Разблокирует функцию автопосадки.',
                    purchased: false,
                    effect: () => {
                        document.getElementById('auto-plant-toggle').disabled = false;
                        document.getElementById('auto-seed-type').disabled = false;
                        saveGame();
                        showNotification('🤖 Автопосадка теперь доступна!');
                        addXP(10);
                    },
                    xp: 10
                },
                {
                    id: 'auto_harvester',
                    name: 'Автосборщик',
                    price: 7400, // Было 2000
                    description: 'Разблокирует функцию автосбора.',
                    purchased: false,
                    effect: () => {
                        document.getElementById('auto-harvest-toggle').disabled = false;
                        saveGame();
                        showNotification('✂️ Автосбор теперь доступен!');
                        addXP(10);
                    },
                    xp: 10
                },
                {
                    id: 'faster_growth_2',
                    name: 'Ускоренный рост II',
                    price: 6000, // Было 5000
                    description: 'Растения растут на 20% быстрее (всего 30%).',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.growthTime = Math.max(1, Math.floor(seed.growthTime * 0.8));
                        });
                        showNotification('⚡ Растения растут еще быстрее!');
                        addXP(15);
                    },
                    requirement: 'faster_growth_1',
                    xp: 15
                },
                {
                    id: 'higher_yield_2',
                    name: 'Повышенный урожай II',
                    price: 9600, // Было 8000
                    description: 'Растения приносят на 25% больше денег (всего 40%).',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.value = Math.floor(seed.value * 1.25);
                        });
                        showNotification('💰 Урожайность значительно повышена!');
                        addXP(15);
                    },
                    requirement: 'higher_yield_1',
                    xp: 15
                },
                {
                    id: 'discount_seeds_2',
                    name: 'Скидка на семена II',
                    price: 12000, // Было 10000
                    description: 'Семена стоят на 30% дешевле (всего 50%).',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.price = Math.max(1, Math.floor(seed.price * 0.7));
                        });
                        updateSeedsUI();
                        showNotification('🎯 Семена теперь значительно дешевле!');
                        addXP(15);
                    },
                    requirement: 'discount_seeds_1',
                    xp: 15
                },
                {
                    id: 'instant_growth',
                    name: 'Мгновенный рост',
                    price: 1200000, // Было 1000000
                    description: 'Растения растут мгновенно!',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.growthTime = 0;
                        });
                        showNotification('⚡ Все растения теперь растут мгновенно!');
                        addXP(50);
                    },
                    requirement: 'faster_growth_2',
                    xp: 50
                },
                {
                    id: 'double_yield',
                    name: 'Двойной урожай',
                    price: 36000, // Было 30000
                    description: 'Растения приносят в 2 раза больше денег.',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.value = seed.value * 2;
                        });
                        showNotification('💰 Урожайность удвоена!');
                        addXP(20);
                    },
                    requirement: 'higher_yield_2',
                    xp: 20
                },
                {
                    id: 'auto_expand',
                    name: 'Авторасширение',
                    price: 30000, // Было 25000
                    description: 'Ферма автоматически расширяется при заполнении всех грядок.',
                    purchased: false,
                    effect: () => {
                        showNotification('🏗️ Автоматическое расширение фермы включено!');
                        addXP(25);
                    },
                    xp: 25
                },
                {
                    id: 'seed_mastery',
                    name: 'Мастерство семян',
                    price: 18000, // Было 15000
                    description: 'Семена стоят на 50% дешевле (всего 70%).',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.price = Math.max(1, Math.floor(seed.price * 0.5));
                        });
                        updateSeedsUI();
                        showNotification('🎯 Семена теперь значительно дешевле!');
                        addXP(20);
                    },
                    requirement: 'discount_seeds_2',
                    xp: 20
                },
                {
                    id: 'quantum_growth',
                    name: 'Квантовый рост',
                    price: 600000, // Было 500000
                    description: 'Растения растут в 10 раз быстрее!',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.growthTime = Math.max(1, Math.floor(seed.growthTime * 0.1));
                        });
                        showNotification('⚛️ Растения растут с квантовой скоростью!');
                        addXP(75);
                    },
                    requirement: 'instant_growth',
                    xp: 75
                },
                {
                    id: 'premium_fertilizer',
                    name: 'Премиум удобрения',
                    price: 120000, // Было 100000
                    description: 'Все растения приносят в 3 раза больше денег.',
                    purchased: false,
                    effect: () => {
                        seeds.forEach(seed => {
                            seed.value = seed.value * 3;
                        });
                        showNotification('🌟 Премиум удобрения увеличили доходность!');
                        addXP(100);
                    },
                    premium: true,
                    requirement: 'double_yield',
                    xp: 100
                },
                {
                    id: 'mega_farm',
                    name: 'Мега ферма',
                    price: 600000, // Было 500000
                    description: 'Начинаете с 20 грядок вместо 5.',
                    purchased: false,
                    effect: () => {
                        if (farmSize < 20) {
                            farmSize = 20;
                            initFarm();
                            updateExpandButton();
                            showNotification('🏭 Ваша ферма стала мега-фермой!');
                            addXP(150);
                        }
                    },
                    premium: true,
                    xp: 150
                },
                {
                    id: 'xp_booster',
                    name: 'Ускоритель опыта',
                    price: 150000,
                    description: 'Получаете на 25% больше опыта за все действия.',
                    purchased: false,
                    effect: () => {
                        showNotification('📈 Теперь вы получаете больше опыта!');
                        addXP(50);
                    },
                    premium: true,
                    xp: 50
                }
            ];
        }
        
        // Добавление опыта игроку
        function addXP(amount) {
            if (upgrades.find(u => u.id === 'xp_booster')?.purchased) {
                amount = Math.floor(amount * 1.25);
            }
            
            stats.playerXP += amount;
            const xpNeeded = stats.playerLevel * 100;
            
            if (stats.playerXP >= xpNeeded) {
                stats.playerLevel++;
                stats.playerXP = stats.playerXP - xpNeeded;
                showNotification(`🎉 Уровень повышен! Теперь у вас ${stats.playerLevel} уровень`);
                
                // Награда за уровень
                const levelReward = stats.playerLevel * 1000;
                addMoney(levelReward);
                showNotification(`💰 Получено ${levelReward} $ за новый уровень!`);
            }
            
            updateLevelUI();
        }
        
        // Обновление отображения уровня
        function updateLevelUI() {
            const xpNeeded = stats.playerLevel * 100;
            const progress = (stats.playerXP / xpNeeded) * 100;
            
            const levelProgress = document.getElementById('level-progress');
            levelProgress.style.width = `${progress}%`;
            levelProgress.querySelector('.level-text').textContent = `Уровень: ${stats.playerLevel}`;
        }
        
        // Инициализация фермы
        function initFarm() {
            const farmContainer = document.getElementById('farm-container');
            
            // Сохраняем текущие растения перед переинициализацией
            const currentPlants = plots.map(plot => ({
                plant: plot.plant,
                growthStart: plot.growthStart
            }));
            
            farmContainer.innerHTML = '';
            plots = [];
            
            for (let i = 0; i < farmSize; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                if (i >= currentPlants.length || !currentPlants[i].plant) {
                    plot.classList.add('empty');
                }
                plot.dataset.index = i;
                
                plot.addEventListener('click', () => handlePlotClick(i));
                
                farmContainer.appendChild(plot);
                
                // Восстанавливаем растения при расширении фермы
                const plantData = i < currentPlants.length ? currentPlants[i] : null;
                plots.push({
                    element: plot,
                    plant: plantData?.plant || null,
                    growthStart: plantData?.growthStart || null
                });
            }
            
            // Обновляем визуализацию всех грядок
            plots.forEach((plot, index) => {
                if (plot.plant) {
                    updatePlotVisual(index);
                }
            });
        }
        
        // Обработка клика по грядке
        function handlePlotClick(index) {
            const plot = plots[index];
            
            if (plot.plant) {
                if (isPlantReady(index)) {
                    harvestPlant(index);
                } else {
                    showNotification('⏳ Растение еще не созрело!');
                }
            } else {
                showSeedSelection(index);
            }
        }
        
        // Показать меню выбора семян
        function showSeedSelection(plotIndex) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            const modalHeader = document.createElement('div');
            modalHeader.className = 'modal-header';
            modalHeader.innerHTML = '<span>🌱</span> Выберите семена';
            
            const modalBody = document.createElement('div');
            modalBody.className = 'modal-body';
            
            seeds.forEach(seed => {
                if (!seed.unlocked) return;
                
                const seedItem = document.createElement('div');
                seedItem.className = 'seed-item';
                seedItem.style.cursor = money >= seed.price ? 'pointer' : 'not-allowed';
                seedItem.style.opacity = money >= seed.price ? '1' : '0.7';
                
                const itemHeader = document.createElement('div');
                itemHeader.className = 'item-header';
                
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.innerHTML = `<span>${seed.emoji}</span> ${seed.name}`;
                
                const itemPrice = document.createElement('div');
                itemPrice.className = 'item-price';
                itemPrice.textContent = `$${seed.price.toLocaleString()}`;
                
                const itemBody = document.createElement('div');
                itemBody.className = 'item-body';
                
                const itemDesc = document.createElement('div');
                itemDesc.className = 'item-desc';
                itemDesc.textContent = seed.description;
                
                const itemStats = document.createElement('div');
                itemStats.className = 'item-stats';
                
                const growthTime = document.createElement('div');
                growthTime.textContent = `⏱️ ${seed.growthTime} сек`;
                
                const yieldValue = document.createElement('div');
                yieldValue.textContent = `💰 $${seed.value.toLocaleString()}`;
                
                const xpValue = document.createElement('div');
                xpValue.textContent = `📈 ${seed.xp} опыта`;
                
                itemHeader.appendChild(itemName);
                itemHeader.appendChild(itemPrice);
                itemBody.appendChild(itemDesc);
                itemStats.appendChild(growthTime);
                itemStats.appendChild(yieldValue);
                itemStats.appendChild(xpValue);
                itemBody.appendChild(itemStats);
                
                seedItem.appendChild(itemHeader);
                seedItem.appendChild(itemBody);
                
                if (money >= seed.price) {
                    seedItem.addEventListener('click', () => {
                        plantSeed(plotIndex, seed.id);
                        document.body.removeChild(modal);
                    });
                }
                
                modalBody.appendChild(seedItem);
            });
            
            const modalFooter = document.createElement('div');
            modalFooter.className = 'modal-footer';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'modal-btn modal-btn-secondary';
            cancelBtn.textContent = 'Отмена';
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modalFooter.appendChild(cancelBtn);
            modalContent.appendChild(modalHeader);
            modalContent.appendChild(modalBody);
            modalContent.appendChild(modalFooter);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        // Посадить семена
        function plantSeed(plotIndex, seedId) {
            const seed = seeds.find(s => s.id === seedId);
            if (!seed || seed.price > money) return;
            
            addMoney(-seed.price);
            stats.seedsPlanted++;
            stats.moneySpent += seed.price;
            
            const plot = plots[plotIndex];
            plot.plant = seedId;
            plot.growthStart = Date.now();
            plot.element.classList.remove('empty');
            
            updatePlotVisual(plotIndex);
            updateSeedsUI();
            updateUpgradesUI();
            updateStatsUI();
            
            addXP(seed.xp);
            checkAutoExpand();
            checkAchievements();
        }
        
        // Проверить готовность растения
        function isPlantReady(plotIndex) {
            const plot = plots[plotIndex];
            if (!plot.plant || !plot.growthStart) return false;
            
            const seed = seeds.find(s => s.id === plot.plant);
            const growthTime = seed.growthTime * 1000;
            const timePassed = Date.now() - plot.growthStart;
            
            return timePassed >= growthTime;
        }
        
        // Собрать растение
        function harvestPlant(plotIndex) {
            const plot = plots[plotIndex];
            if (!plot.plant) return;
            
            const seed = seeds.find(s => s.id === plot.plant);
            addMoney(seed.value);
            stats.plantsHarvested++;
            stats.totalMoneyEarned += seed.value;
            stats.plantsHarvestedByType[seed.id]++;
            
            plot.plant = null;
            plot.growthStart = null;
            plot.element.classList.add('empty');
            
            updatePlotVisual(plotIndex);
            updateStatsUI();
            updateUpgradesUI();
            updateSeedsUI();
            
            addXP(seed.xp * 2); // Больше опыта за сбор урожая
            unlockNewSeeds();
            checkAchievements();
            
            if (autoPlantEnabled && autoSeedType) {
                setTimeout(() => {
                    plantSeed(plotIndex, autoSeedType);
                }, 100);
            }
        }
        
        // Обновить визуализацию грядки
        function updatePlotVisual(plotIndex) {
            const plot = plots[plotIndex];
            plot.element.innerHTML = '';
            
            if (plot.plant) {
                const seed = seeds.find(s => s.id === plot.plant);
                const growthTime = seed.growthTime * 1000;
                const timePassed = Date.now() - plot.growthStart;
                const progress = Math.min(timePassed / growthTime, 1);
                
                const plantDiv = document.createElement('div');
                plantDiv.className = 'plant';
                
                const plantImage = document.createElement('div');
                plantImage.className = 'plant-image';
                plantImage.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="50" font-size="60" text-anchor="middle" dominant-baseline="middle">${seed.emoji}</text></svg>')`;
                plantImage.style.opacity = isPlantReady(plotIndex) ? '1' : '0.8';
                
                const progressContainer = document.createElement('div');
                progressContainer.className = 'progress-container';
                
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = `${progress * 100}%`;
                
                const valueDisplay = document.createElement('div');
                valueDisplay.className = 'plant-value';
                valueDisplay.textContent = `$${seed.value}`;
                
                if (isPlantReady(plotIndex)) {
                    plantDiv.classList.add('pulse');
                    if (seed.value >= 10000) {
                        plantDiv.classList.add('shine');
                    }
                }
                
                progressContainer.appendChild(progressBar);
                plantDiv.appendChild(plantImage);
                plantDiv.appendChild(progressContainer);
                plantDiv.appendChild(valueDisplay);
                plot.element.appendChild(plantDiv);
            }
        }
        
        // Добавить деньги
        function addMoney(amount) {
            money += amount;
            updateMoneyUI();
            updateUpgradesUI();
            updateSeedsUI();
            unlockNewSeeds();
            checkAchievements();
        }
        
        // Проверить растения (для автоматизации)
        function checkPlants() {
            plots.forEach((plot, index) => {
                if (plot.plant) {
                    if (isPlantReady(index)) {
                        if (autoHarvestEnabled) {
                            harvestPlant(index);
                        } else {
                            updatePlotVisual(index);
                        }
                    } else {
                        updatePlotVisual(index);
                    }
                } else if (autoPlantEnabled && autoSeedType) {
                    plantSeed(index, autoSeedType);
                }
            });
        }
        
        // Проверить авторасширение фермы
        function checkAutoExpand() {
            const autoExpandUpgrade = upgrades.find(u => u.id === 'auto_expand');
            if (!autoExpandUpgrade || !autoExpandUpgrade.purchased) return;
            
            const hasEmptyPlots = plots.some(p => !p.plant);
            if (!hasEmptyPlots) {
                expandFarm();
            }
        }
        
        // Расширить ферму
        function expandFarm() {
            const cost = Math.floor(100 * Math.pow(1.25, stats.farmExpansions)); // Увеличена сложность
            if (money < cost) return;
            
            addMoney(-cost);
            stats.moneySpent += cost;
            farmSize++;
            stats.farmExpansions++;
            
            initFarm();
            updateExpandButton();
            updateStatsUI();
            addXP(10);
            checkAchievements();
        }
        
        // Проверить достижения
        function checkAchievements() {
            const achievements = [
                {
                    id: 'first_harvest',
                    name: 'Первый урожай',
                    description: 'Соберите свое первое растение',
                    condition: () => stats.plantsHarvested >= 1,
                    unlocked: false,
                    reward: 100,
                    xp: 10
                },
                {
                    id: 'beginner_farmer',
                    name: 'Начинающий фермер',
                    description: 'Соберите 10 растений',
                    condition: () => stats.plantsHarvested >= 10,
                    unlocked: false,
                    reward: 500,
                    xp: 25
                },
                {
                    id: 'expert_farmer',
                    name: 'Опытный фермер',
                    description: 'Соберите 100 растений',
                    condition: () => stats.plantsHarvested >= 100,
                    unlocked: false,
                    reward: 5000,
                    xp: 50
                },
                {
                    id: 'millionaire',
                    name: 'Миллионер',
                    description: 'Заработайте $1,000,000',
                    condition: () => stats.totalMoneyEarned >= 1000000,
                    unlocked: false,
                    reward: 100000,
                    xp: 100
                },
                {
                    id: 'farm_expander',
                    name: 'Расширитель фермы',
                    description: 'Расширьте ферму до 20 грядок',
                    condition: () => farmSize >= 20,
                    unlocked: false,
                    reward: 20000,
                    xp: 75
                },
                {
                    id: 'golden_farmer',
                    name: 'Золотой фермер',
                    description: 'Соберите 1000 золотых ягод',
                    condition: () => stats.plantsHarvestedByType['golden_berry'] >= 1000,
                    unlocked: false,
                    reward: 500000,
                    xp: 200,
                    premium: true
                },
                {
                    id: 'upgrade_master',
                    name: 'Мастер улучшений',
                    description: 'Купите все обычные улучшения',
                    condition: () => upgrades.filter(u => !u.premium).every(u => u.purchased),
                    unlocked: false,
                    reward: 250000,
                    xp: 150
                },
                {
                    id: 'premium_player',
                    name: 'Премиум игрок',
                    description: 'Купите все премиум улучшения',
                    condition: () => upgrades.filter(u => u.premium).every(u => u.purchased),
                    unlocked: false,
                    reward: 1000000,
                    xp: 300,
                    premium: true
                }
            ];
            
            achievements.forEach(achievement => {
                if (!achievement.unlocked && achievement.condition()) {
                    achievement.unlocked = true;
                    if (!stats.achievements.includes(achievement.id)) {
                        stats.achievements.push(achievement.id);
                        addMoney(achievement.reward);
                        addXP(achievement.xp);
                        showNotification(`🏆 Достижение: ${achievement.name}! +$${achievement.reward.toLocaleString()} и ${achievement.xp} опыта`);
                    }
                }
            });
        }
        
        // Показать уведомление
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3500);
        }
        
        // Обновить интерфейс
        function updateUI() {
            updateMoneyUI();
            updateSeedsUI();
            updateUpgradesUI();
            updateStatsUI();
            updateExpandButton();
            updateLevelUI();
            
            // Инициализация вкладок
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const panels = document.querySelectorAll('.panel');
                    panels.forEach(panel => panel.classList.remove('active'));
                    
                    const panelId = tab.dataset.panel;
                    document.getElementById(panelId).classList.add('active');
                });
            });
            
            // Инициализация переключателей автоматизации
            const autoPlantToggle = document.getElementById('auto-plant-toggle');
            const autoHarvestToggle = document.getElementById('auto-harvest-toggle');
            
            autoPlantToggle.addEventListener('change', (e) => {
                autoPlantEnabled = e.target.checked;
                saveGame();
            });
            
            autoHarvestToggle.addEventListener('change', (e) => {
                autoHarvestEnabled = e.target.checked;
                saveGame();
            });
            
            // Кнопка расширения фермы
            document.getElementById('expand-farm-btn').addEventListener('click', expandFarm);
        }
        
        // Обновить отображение денег
        function updateMoneyUI() {
            document.getElementById('money-display').textContent = money.toLocaleString();
        }
        
        // Обновить список семян
        function updateSeedsUI() {
            const seedsList = document.getElementById('seeds-list');
            seedsList.innerHTML = '';
            
            seeds.forEach(seed => {
                if (!seed.unlocked) return;
                
                const seedItem = document.createElement('div');
                seedItem.className = 'seed-item';
                
                const itemHeader = document.createElement('div');
                itemHeader.className = 'item-header';
                
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.innerHTML = `<span>${seed.emoji}</span> ${seed.name}`;
                
                const itemPrice = document.createElement('div');
                itemPrice.className = 'item-price';
                itemPrice.textContent = `$${seed.price.toLocaleString()}`;
                
                const itemBody = document.createElement('div');
                itemBody.className = 'item-body';
                
                const itemDesc = document.createElement('div');
                itemDesc.className = 'item-desc';
                itemDesc.textContent = seed.description;
                
                const itemStats = document.createElement('div');
                itemStats.className = 'item-stats';
                
                const growthTime = document.createElement('div');
                growthTime.textContent = `⏱️ ${seed.growthTime} сек`;
                
                const yieldValue = document.createElement('div');
                yieldValue.textContent = `💰 $${seed.value.toLocaleString()}`;
                
                const xpValue = document.createElement('div');
                xpValue.textContent = `📈 ${seed.xp} опыта`;
                
                const buyBtn = document.createElement('button');
                buyBtn.className = 'buy-btn';
                buyBtn.textContent = 'Купить';
                buyBtn.disabled = money < seed.price;
                
                buyBtn.addEventListener('click', () => {
                    const emptyPlotIndex = plots.findIndex(p => !p.plant);
                    if (emptyPlotIndex !== -1) {
                        plantSeed(emptyPlotIndex, seed.id);
                    } else {
                        showNotification('🚧 Нет свободных грядок! Расширьте ферму или соберите урожай.');
                    }
                });
                
                itemHeader.appendChild(itemName);
                itemHeader.appendChild(itemPrice);
                itemBody.appendChild(itemDesc);
                itemStats.appendChild(growthTime);
                itemStats.appendChild(yieldValue);
                itemStats.appendChild(xpValue);
                itemBody.appendChild(itemStats);
                itemBody.appendChild(buyBtn);
                
                seedItem.appendChild(itemHeader);
                seedItem.appendChild(itemBody);
                
                seedsList.appendChild(seedItem);
            });
        }
        
        // Обновить список улучшений
        function updateUpgradesUI() {
            const upgradesList = document.getElementById('upgrades-list');
            upgradesList.innerHTML = '';
            
            upgrades.forEach(upgrade => {
                const requirementMet = !upgrade.requirement || 
                    upgrades.find(u => u.id === upgrade.requirement)?.purchased;
                
                const canAfford = money >= upgrade.price;
                const isPurchased = upgrade.purchased;
                
                if (isPurchased && upgrade.effect) {
                    upgrade.effect();
                }
                
                const upgradeItem = document.createElement('div');
                upgradeItem.className = `upgrade-item ${upgrade.premium ? 'premium-item' : ''}`;
                upgradeItem.style.opacity = isPurchased ? '0.7' : '1';
                
                if (upgrade.premium) {
                    const premiumBadge = document.createElement('div');
                    premiumBadge.className = 'premium-badge';
                    premiumBadge.textContent = 'PREMIUM';
                    upgradeItem.appendChild(premiumBadge);
                }
                
                const itemHeader = document.createElement('div');
                itemHeader.className = 'item-header';
                
                if (isPurchased) {
                    itemHeader.style.background = 'linear-gradient(135deg, #81C784, #4CAF50)';
                } else if (canAfford && requirementMet) {
                    itemHeader.style.background = 'linear-gradient(135deg, #FFB74D, #FF9800)';
                } else {
                    itemHeader.style.background = 'linear-gradient(135deg, #E0E0E0, #9E9E9E)';
                }
                
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.textContent = upgrade.name;
                
                const itemPrice = document.createElement('div');
                itemPrice.className = 'item-price';
                itemPrice.textContent = `$${upgrade.price.toLocaleString()}`;
                
                const itemBody = document.createElement('div');
                itemBody.className = 'item-body';
                
                const itemDesc = document.createElement('div');
                itemDesc.className = 'item-desc';
                itemDesc.textContent = upgrade.description;
                
                if (upgrade.requirement && !upgrades.find(u => u.id === upgrade.requirement)?.purchased) {
                    const reqText = document.createElement('div');
                    reqText.className = 'item-desc';
                    reqText.textContent = `🔒 Требуется: ${upgrades.find(u => u.id === upgrade.requirement).name}`;
                    reqText.style.color = 'red';
                    itemDesc.appendChild(reqText);
                }
                
                const xpValue = document.createElement('div');
                xpValue.className = 'item-desc';
                xpValue.textContent = `📈 Награда: ${upgrade.xp} опыта`;
                xpValue.style.color = '#2E7D32';
                xpValue.style.fontWeight = 'bold';
                itemDesc.appendChild(xpValue);
                
                const buyBtn = document.createElement('button');
                buyBtn.className = `buy-btn ${upgrade.premium ? 'premium-btn' : ''}`;
                buyBtn.textContent = isPurchased ? '✅ Куплено' : 'Купить';
                buyBtn.disabled = isPurchased || !canAfford || !requirementMet;
                
                if (!isPurchased) {
                    buyBtn.addEventListener('click', () => {
                        if (canAfford && requirementMet) {
                            addMoney(-upgrade.price);
                            stats.moneySpent += upgrade.price;
                            upgrade.purchased = true;
                            if (upgrade.effect) upgrade.effect();
                            updateUpgradesUI();
                            updateSeedsUI();
                            updateStatsUI();
                            addXP(upgrade.xp);
                            showNotification(`🎉 Улучшение "${upgrade.name}" приобретено! +${upgrade.xp} опыта`);
                        }
                    });
                }
                
                itemHeader.appendChild(itemName);
                itemHeader.appendChild(itemPrice);
                itemBody.appendChild(itemDesc);
                itemBody.appendChild(buyBtn);
                
                upgradeItem.appendChild(itemHeader);
                upgradeItem.appendChild(itemBody);
                
                upgradesList.appendChild(upgradeItem);
            });
        }
        
        // Обновить статистику
        function updateStatsUI() {
            const statsList = document.getElementById('stats-list');
            statsList.innerHTML = '';
            
            const statItems = [
                { name: '💰 Всего заработано', value: `$${stats.totalMoneyEarned.toLocaleString()}` },
                { name: '💸 Всего потрачено', value: `$${stats.moneySpent.toLocaleString()}` },
                { name: '💵 Чистая прибыль', value: `$${(stats.totalMoneyEarned - stats.moneySpent).toLocaleString()}` },
                { name: '🌱 Растений собрано', value: stats.plantsHarvested.toLocaleString() },
                { name: '🌰 Семян посажено', value: stats.seedsPlanted.toLocaleString() },
                { name: '⏱️ Время игры', value: formatTime(stats.timePlayed) },
                { name: '🏗️ Размер фермы', value: farmSize.toLocaleString() },
                { name: '🔨 Расширений фермы', value: stats.farmExpansions.toLocaleString() },
                { name: '📈 Доход в минуту', value: calculateIncomePerMinute() },
                { name: '🎮 Уровень игрока', value: stats.playerLevel },
                { name: '📊 Опыт', value: `${stats.playerXP}/${stats.playerLevel * 100}` },
                { name: '🏆 Достижений', value: `${stats.achievements.length}/8` }
            ];
            
            // Добавляем статистику по каждому типу растения (только те, что были собраны)
            seeds.forEach(seed => {
                if (stats.plantsHarvestedByType[seed.id] > 0) {
                    statItems.push({
                        name: `${seed.emoji} ${seed.name} собрано`,
                        value: stats.plantsHarvestedByType[seed.id].toLocaleString()
                    });
                }
            });
            
            statItems.forEach(stat => {
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                
                const statName = document.createElement('div');
                statName.className = 'stat-name';
                statName.innerHTML = stat.name;
                
                const statValue = document.createElement('div');
                statValue.className = 'stat-value';
                statValue.textContent = stat.value;
                
                statCard.appendChild(statName);
                statCard.appendChild(statValue);
                statsList.appendChild(statCard);
            });
        }
        
        // Рассчитать доход в минуту
        function calculateIncomePerMinute() {
            let totalIncomePerMinute = 0;
            
            seeds.forEach(seed => {
                const harvested = stats.plantsHarvestedByType[seed.id] || 0;
                if (harvested > 0 && seed.growthTime > 0) {
                    const plantsPerMinute = 60 / seed.growthTime;
                    totalIncomePerMinute += plantsPerMinute * seed.value;
                }
            });
            
            return `$${Math.round(totalIncomePerMinute).toLocaleString()}`;
        }
        
        // Форматирование времени
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Обновить кнопку расширения фермы
        function updateExpandButton() {
            const cost = Math.floor(100 * Math.pow(1.25, stats.farmExpansions));
            const btn = document.getElementById('expand-farm-btn');
            btn.innerHTML = `<span>🔄</span> Расширить ферму ($${cost.toLocaleString()})`;
            btn.disabled = money < cost;
        }
        
        // Сохранить игру
        function saveGame() {
            const gameData = {
                money,
                farmSize,
                plots: plots.map(plot => ({
                    plant: plot.plant,
                    growthStart: plot.growthStart
                })),
                stats,
                upgrades: upgrades.map(upgrade => ({
                    id: upgrade.id,
                    purchased: upgrade.purchased
                })),
                autoPlantEnabled,
                autoHarvestEnabled,
                autoSeedType,
                lastSave: Date.now()
            };
            
            localStorage.setItem('plantFarmGame', JSON.stringify(gameData));
        }
        
        // Загрузить игру
        function loadGame() {
            const savedData = localStorage.getItem('plantFarmGame');
            if (!savedData) return;
            
            try {
                const gameData = JSON.parse(savedData);
                
                money = gameData.money || 0;
                farmSize = gameData.farmSize || 5;
                
                // Восстанавливаем статистику
                stats = gameData.stats || {
                    totalMoneyEarned: 0,
                    plantsHarvested: 0,
                    seedsPlanted: 0,
                    moneySpent: 0,
                    timePlayed: 0,
                    farmExpansions: 0,
                    plantsHarvestedByType: {},
                    achievements: [],
                    playerLevel: 1,
                    playerXP: 0
                };
                
                // Восстанавливаем улучшения
                if (gameData.upgrades) {
                    upgrades.forEach(upgrade => {
                        const savedUpgrade = gameData.upgrades.find(u => u.id === upgrade.id);
                        if (savedUpgrade) {
                            upgrade.purchased = savedUpgrade.purchased;
                            if (upgrade.purchased && upgrade.effect) {
                                upgrade.effect();
                            }
                        }
                    });
                }
                
                // Восстанавливаем автоматизацию
                autoPlantEnabled = gameData.autoPlantEnabled || false;
                autoHarvestEnabled = gameData.autoHarvestEnabled || false;
                autoSeedType = gameData.autoSeedType || null;
                
                document.getElementById('auto-plant-toggle').checked = autoPlantEnabled;
                document.getElementById('auto-harvest-toggle').checked = autoHarvestEnabled;
                
                if (autoSeedType) {
                    document.getElementById('auto-seed-type').value = autoSeedType;
                }
                
                // Разблокируем элементы автоматизации, если улучшения куплены
                const autoPlanter = upgrades.find(u => u.id === 'auto_planter');
                const autoHarvester = upgrades.find(u => u.id === 'auto_harvester');
                
                if (autoPlanter?.purchased) {
                    document.getElementById('auto-plant-toggle').disabled = false;
                    document.getElementById('auto-seed-type').disabled = false;
                }
                
                if (autoHarvester?.purchased) {
                    document.getElementById('auto-harvest-toggle').disabled = false;
                }
                
                // Инициализируем ферму
                initFarm();
                
                // Восстанавливаем растения на грядках
                if (gameData.plots) {
                    gameData.plots.forEach((savedPlot, index) => {
                        if (index < plots.length && savedPlot.plant && savedPlot.growthStart) {
                            // Корректируем время роста с момента последнего сохранения
                            const timePassed = Date.now() - (gameData.lastSave || Date.now());
                            plots[index].plant = savedPlot.plant;
                            plots[index].growthStart = savedPlot.growthStart - timePassed;
                            
                            updatePlotVisual(index);
                        }
                    });
                }
                
                // Разблокируем семена в соответствии с прогрессом
                unlockNewSeeds();
                
                updateUI();
            } catch (e) {
                console.error('Ошибка загрузки игры:', e);
            }
        }
        
        // Запуск игры при загрузке страницы
        window.addEventListener('load', initGame);
    </script>
</body>
</html>